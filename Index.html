<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éå»ç¾åœ¨çµµå› æœçµŒï¼šå–„æ…§ç«¥å­ã®ä¿®è¡Œ (è»½é‡ç‰ˆ+ç«‹ã¡çµµ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š */
        body { font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif; }

        /* ã‚·ãƒ¼ãƒ³å…¨ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        #gameContainer {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            background-color: #fce7f3;
            background-image: 
                radial-gradient(circle at 10% 10%, #f9a8d4 1px, transparent 1px),
                radial-gradient(circle at 90% 90%, #f9a8d4 1px, transparent 1px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px;
            position: relative; 
            overflow: hidden; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’éè¡¨ç¤ºã«ã™ã‚‹ãŸã‚ */
        }

        /* ç”»åƒè¡¨ç¤ºã‚¨ãƒªã‚¢ (æ­£æ–¹å½¢ã®æ ã«èª¿æ•´) */
        #sceneImage {
            width: 95%;
            max-width: 500px;
            aspect-ratio: 1 / 1; 
            height: auto; 
            background-size: contain; 
            background-repeat: no-repeat; 
            background-position: center;
            transition: opacity 0.5s ease-in-out; 
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        /* ç™½ã„ãƒ¢ãƒ¤ï¼ˆãƒ•ã‚§ãƒ¼ãƒ‰ï¼‰ç”¨ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        #fadeOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
            z-index: 20;
            pointer-events: none; 
        }

        /* å¹ãå‡ºã—ã‚¨ãƒªã‚¢ */
        #dialogBox {
            width: 95%;
            max-width: 500px; 
            min-height: 120px; 
            padding: 1rem;
            margin: 1rem 0;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            cursor: pointer; 
            z-index: 10; 
        }

        /* é€²è¡Œãƒœã‚¿ãƒ³ï¼ˆã‚¿ãƒƒãƒ—ï¼‰ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
        @keyframes bounce-tap {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        #nextButton {
            position: absolute;
            bottom: 0.5rem;
            right: 0.5rem;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: bold;
            color: #3b82f6; 
            background-color: #e0f2fe; 
            border: 2px solid #3b82f6;
            border-radius: 9999px;
            cursor: pointer;
            transition: background-color 0.1s;
            animation: bounce-tap 1s infinite;
        }

        #nextButton:active {
            transform: scale(0.95) translateY(0) !important;
            animation: none;
        }
        
        /* é¸æŠè‚¢ãƒœã‚¿ãƒ³ */
        .choice-button {
            width: 100%;
            padding: 0.75rem;
            margin-top: 0.5rem;
            background-color: #3b82f6; 
            color: white;
            border: none;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.15s, transform 0.05s;
            text-align: left;
            box-shadow: 0 2px 4px 0 rgba(0, 0, 0, 0.1);
        }

        .choice-button:hover {
            background-color: #2563eb; 
        }

        .choice-button:active {
            transform: scale(0.99);
        }
        
        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åè¡¨ç¤º */
        #smidaName {
            background-color: #a7f3d0; 
            color: #065f46; 
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem; 
            font-weight: bold;
            margin-bottom: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç«‹ã¡çµµã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #characterPortrait {
            position: absolute;
            bottom: calc(120px + 1rem); 
            /* èª¿æ•´ã•ã‚ŒãŸã‚µã‚¤ã‚º */
            width: 200px; /* ã•ã‚‰ã«å¤§ãã */
            height: auto;
            max-height: 350px; /* ã•ã‚‰ã«å¤§ãã */
            object-fit: contain; 
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3)); 
            z-index: 5; 
            transition: opacity 0.3s ease-in-out;
            opacity: 0; 
        }

        /* ç”»é¢å¹…ãŒåºƒã„å ´åˆã®èª¿æ•´ */
        @media (min-width: 640px) {
             #characterPortrait {
                /* 500pxãƒœãƒƒã‚¯ã‚¹ã®å·¦ç«¯ã¯ç”»é¢ä¸­å¤®-250pxã€‚ç«‹ã¡çµµã®å¹…ãŒ200px */
                left: calc(50% - 250px);
                transform: translateX(0); /* æ¨ªæ–¹å‘ã®èª¿æ•´ã‚’è§£é™¤ */
            }
        }
        
        /* ç”»é¢å¹…ãŒç‹­ã„å ´åˆï¼ˆãƒ¢ãƒã‚¤ãƒ«ï¼‰ã®èª¿æ•´ */
        @media (max-width: 639px) {
            #characterPortrait {
                /* ãƒ¢ãƒã‚¤ãƒ«ã§ã¯å¹ãå‡ºã—ã«é‡ã­ã‚‹å½¢ã§å°‘ã—å†…å´ã«é…ç½® */
                left: 10px; /* ç”»é¢å·¦ç«¯ã‹ã‚‰ã®ã‚ªãƒ•ã‚»ãƒƒãƒˆ */
                bottom: calc(120px + 2rem); 
                max-height: 300px; /* ãƒ¢ãƒã‚¤ãƒ«ã‚‚å¤§ãã */
                width: 170px; /* ãƒ¢ãƒã‚¤ãƒ«ã‚‚å¤§ãã */
            }
        }


        #characterPortrait.active {
            opacity: 1; 
        }

        /* --- ã‚¿ã‚¤ãƒˆãƒ«/èª¬æ˜ç”»é¢å°‚ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
        #titleScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #fff; /* ç™½ã„èƒŒæ™¯ */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            box-sizing: border-box;
            z-index: 100; /* æœ€å‰é¢ã«è¡¨ç¤º */
            opacity: 1;
            transition: opacity 1s ease-out;
            overflow-y: auto; /* èª¬æ˜ãŒé•·ã„å ´åˆã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã«ã™ã‚‹ */
        }

        #titleScreen.hidden {
            opacity: 0;
            pointer-events: none; /* éè¡¨ç¤ºæ™‚ã¯ã‚¯ãƒªãƒƒã‚¯ã§ããªã„ã‚ˆã†ã«ã™ã‚‹ */
        }

        #titleImage {
            max-width: 90%;
            max-height: 40vh; /* ç”»é¢ã®é«˜ã•ã®40% */
            margin-bottom: 1.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        #titleScreen h1 {
            font-size: 2.25rem; /* text-4xl */
            font-weight: bold;
            color: #4a4a4a;
            margin-bottom: 1rem;
            text-align: center;
        }

        #titleScreen p {
            font-size: 1rem; /* text-base */
            color: #6a6a6a;
            line-height: 1.6;
            margin-bottom: 1rem;
            max-width: 600px;
            text-align: left;
            padding: 0 1rem;
        }

        #startButton {
            padding: 0.75rem 2rem;
            background-color: #4CAF50; /* ç·‘è‰²ã®ãƒœã‚¿ãƒ³ */
            color: white;
            border: none;
            border-radius: 9999px;
            font-size: 1.25rem; /* text-xl */
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            margin-top: 1.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        #startButton:hover {
            background-color: #45a049;
        }

        #startButton:active {
            transform: scale(0.98);
        }

    </style>
</head>
<body>

<div id="gameContainer">
    
    <!-- ã‚¿ã‚¤ãƒˆãƒ«/èª¬æ˜ç”»é¢ --><div id="titleScreen">
        <img id="titleImage" src="https://i.postimg.cc/pXTHz2Cj/IMG-5384.jpg" alt="éå»ç¾åœ¨çµµå› æœçµŒã®ã‚¤ãƒ¡ãƒ¼ã‚¸">
        <h1>éå»ç¾åœ¨çµµå› æœçµŒï¼šå–„æ…§ç«¥å­ã®ä¿®è¡Œ</h1>
        <p>ã€Œéå»ç¾åœ¨çµµå› æœçµŒã€ã¨ã¯ã€ä»æ•™ã®é‡è¦ãªæ•™å…¸ã®ä¸€ã¤ã§ã€é‡ˆè¿¦ãŒæ‚Ÿã‚Šã‚’é–‹ãã¾ã§ã®ã€Œéå»ä¸–ï¼ˆå‰ä¸–ï¼‰ã€ã¨ã€ç¾ä¸–ã§ä»é™€ã¨ãªã‚‹ã¾ã§ã®ã€Œç¾åœ¨ä¸–ï¼ˆç¾ä¸–ï¼‰ã€ã®ç‰©èªã‚’çµµã¨æ–‡ç« ã§è¡¨ç¾ã—ãŸã‚‚ã®ã§ã™ã€‚</p>
        <p>ã“ã®ç‰©èªã¯ã€é‡ˆè¿¦ãŒãªãœå‰å¤§ãªä»é™€ã¨ãªã£ãŸã®ã‹ã€ãã®æ ¹æºçš„ãªç†ç”±ã‚’æ¢ã‚‹ä¸Šã§éå¸¸ã«é‡è¦ã§ã™ã€‚ç‰¹ã«ã€éå»ä¸–ã§ã®å–„è¡ŒãŒã©ã®ã‚ˆã†ã«æœªæ¥ã®æœå ±ï¼ˆæ‚Ÿã‚Šï¼‰ã«ç¹‹ãŒã‚‹ã®ã‹ã¨ã„ã†ã€Œå› æœã®ç†ã€ãŒèª¬ã‹ã‚Œã¦ã„ã¾ã™ã€‚</p>
        <p>ã“ã®ã‚²ãƒ¼ãƒ ã§ã¯ã€ãã®ä¸­ã§ã‚‚ç‰¹ã«æœ‰åãªã€Œå–„æ…§ç«¥å­ï¼ˆãœã‚“ãˆã©ã†ã˜ï¼‰ã€ã¨ã—ã¦ä¿®è¡Œã—ã¦ã„ãŸå‰ä¸–ã®ç‰©èªã‚’è¿½ä½“é¨“ã—ã¾ã™ã€‚ã‚ãªãŸã®é¸æŠãŒã€å–„æ…§ç«¥å­ã®æœªæ¥ã€ã™ãªã‚ã¡æœªæ¥ã®é‡ˆè¿¦ã¨ãªã‚‹ã€Œå› ã€ã‚’ã©ã®ã‚ˆã†ã«ç©ã‚€ã‹ã«å½±éŸ¿ã—ã¾ã™ã€‚</p>
        <button id="startButton">ã‚²ãƒ¼ãƒ é–‹å§‹</button>
    </div>

    <!-- ã‚·ãƒ¼ãƒ³ç”»åƒã‚¨ãƒªã‚¢ --><div id="sceneImage">
        <!-- ç™½ã„ãƒ¢ãƒ¤ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ --><div id="fadeOverlay"></div>
    </div>

    <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç«‹ã¡çµµ --><img id="characterPortrait" src="" alt="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®ç«‹ã¡çµµ" class="hidden">

    <!-- å¹ãå‡ºã—ã‚¨ãƒªã‚¢ --><div id="dialogBox">
        <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åï¼ˆã‚»ãƒªãƒ•ãŒã‚ã‚‹å ´åˆã®ã¿è¡¨ç¤ºï¼‰ --><div id="smidaName" class="hidden"></div>
        <!-- ã‚»ãƒªãƒ•ã¾ãŸã¯ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ --><p id="dialogText" class="text-gray-900 text-lg leading-relaxed"></p>
        
        <!-- é¸æŠè‚¢ã‚¨ãƒªã‚¢ --><div id="choicesContainer" class="w-full mt-2 space-y-2">
            <!-- é¸æŠè‚¢ãƒœã‚¿ãƒ³ãŒJSã«ã‚ˆã£ã¦æŒ¿å…¥ã•ã‚Œã¾ã™ --></div>

        <!-- é€²è¡Œãƒœã‚¿ãƒ³ --><button id="nextButton" class="hidden" aria-label="æ¬¡ã®ã‚·ãƒ¼ãƒ³ã¸é€²ã‚€">æ¬¡ã¸ >></button>
    </div>
</div>

<script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªã‚²ãƒ¼ãƒ çŠ¶æ…‹
    let currentSceneId = 'P0_Title'; // åˆæœŸã‚·ãƒ¼ãƒ³ã‚’ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã«è¨­å®š
    let isTransitioning = false;
    let preEonsCleared = false;
    let typingInterval = null;
    let isTyping = false;
    
    // å¤±æ•—æ™‚ã«ä½¿ç”¨ã™ã‚‹ç”»åƒURL
    const FAIL_IMAGE_URL = 'https://i.postimg.cc/MZ0TdK1Y/IMG-5383.jpg';
    
    // ** æœ€çµ‚çš„ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç«‹ã¡çµµã®URLï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æŒ‡ç¤ºã«åŸºã¥ãï¼‰ **
    // 1æšç›®: ç‡ƒç‡ˆä»
    const PORTRAIT_BUDDHA = 'https://i.postimg.cc/25N5mDBj/IMG-5381.png'; 
    // 2æšç›®: å–„æ…§ç«¥å­ (ç”·æ€§)
    const PORTRAIT_MAN_HANDS = 'https://i.postimg.cc/hGRGgB7D/IMG-5380.png'; 
    // 3æšç›®: èŠ±ã‚’æŒã£ã¦ãªã„å¥³æ€§ (ä½¿ç”¨ã—ãªã„ãŒå®šç¾©ã¯æ®‹ã™)
    const PORTRAIT_WOMAN_NO_FLOWER = 'https://i.postimg.cc/ZqzqZSyT/IMG-5379.png'; 
    // 4æšç›®: èŠ±ã‚’æŒã£ã¦ã„ã‚‹å¥³æ€§
    const PORTRAIT_WOMAN_FLOWER = 'https://i.postimg.cc/g0b0dW6F/IMG-5378.png'; 

    /**
     * ã‚¯ãƒªãƒƒã‚¯å‹•ä½œã®ãƒ­ã‚°å‡ºåŠ›ï¼ˆéŸ³å£°ã¯è»½é‡åŒ–ã®ãŸã‚ç„¡åŠ¹ï¼‰
     */
    function playClick() {
        console.log("Click (Sound Disabled)");
    }

    /**
     * ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆç«‹ã¡çµµURLã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼è¨­å®šã‚’æœ€æ–°ã«æ›´æ–°ï¼‰
     */
    const gameData = {
        'P0_Title': { // ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã¯ç‰¹åˆ¥æ‰±ã„ãªã®ã§ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã«ã¯è©³ç´°ä¸è¦ã ãŒã€å®šç¾©ã¯æ®‹ã™
            img: null, char: null, dialog: null, text: null, next: 'P1_Intro', choices: null, portrait: null 
        },
        
        // **ä¿®æ­£ç‚¹: P1_Intro ã‚·ãƒ¼ãƒ³ã«å–„æ…§ç«¥å­ã®ç«‹ã¡çµµã‚’è¿½åŠ **
        'P1_Intro': { img: 'https://i.postimg.cc/kD7Qd2ff/image.png', char: 'å–„æ…§ç«¥å­', dialog: 'ã“ã“ã¯é ã„éå»ã®ä¸–ã€‚ã‚ãªãŸã¯**å–„æ…§ç«¥å­**ã¨ã—ã¦ã€ä¿®è¡Œã®èº«ã€‚æ£®ã§è‰æœ¨ã‚’æ¡é›†ã—ã€ç”Ÿè¨ˆã‚’ç«‹ã¦ã¦ã„ã¾ã™ã€‚', text: 'ã“ã‚Œã¯ã€æœªæ¥ã®é‡ˆè¿¦ã¨ãªã‚‹å–„æ…§ç«¥å­ã®ç‰©èªã§ã‚ã‚‹ã€‚', next: 'P2_News', choices: null, portrait: PORTRAIT_MAN_HANDS }, 
        
        // ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚·ãƒ¼ãƒ³ã€‚ç«‹ã¡çµµã¯ãªã—
        'P2_News': { img: 'https://i.postimg.cc/3W3XHknP/image.png', char: null, dialog: null, text: 'è¡—ã§ã¯ã€**ç‡ƒç‡ˆä»ï¼ˆã­ã‚“ã¨ã†ã¶ã¤ï¼‰**ã¨ã„ã†å‰å¤§ãªä»æ§˜ãŒãŠã„ã§ã«ãªã‚‹ã¨ã„ã†å™‚ã§æŒã¡ãã‚Šã§ã‚ã£ãŸã€‚ç‡ƒç‡ˆä»ã«ä¾›é¤Šã™ã‚Œã°ã€å¤§ããªåŠŸå¾³ãŒå¾—ã‚‰ã‚Œã‚‹ã§ã‚ã‚ã†ã€‚', next: 'P3_Desire', choices: null, portrait: null },
        
        // å–„æ…§ç«¥å­ã®ã‚»ãƒªãƒ•
        'P3_Desire': { img: 'https://i.postimg.cc/kD7Qd2ff/image.png', char: 'å–„æ…§ç«¥å­', dialog: 'ç§ã‚‚ç‡ƒç‡ˆä»æ§˜ã«ãŠä¾›ãˆã‚’ã—ãŸã„ï¼ã—ã‹ã—ã€ç§ã¯è²§ã—ãã€æ‰‹å…ƒã«ã¯ä½•ã‚‚ä¾›é¤Šã§ãã‚‹ã‚‚ã®ãŒã‚ã‚Šã¾ã›ã‚“...', text: 'å–„æ…§ç«¥å­ã¯ã€ä»ã¸ã®å¼·ã„å¸°ä¾ã®å¿ƒã«çªãå‹•ã‹ã•ã‚Œã¦ã„ãŸã€‚', next: 'P4_Flowers', choices: null, portrait: PORTRAIT_MAN_HANDS },
        
        // **ä¿®æ­£ç‚¹: P4_Flowers ã‚·ãƒ¼ãƒ³ã«èŠ±ã‚’æŒã£ã¦ã„ã‚‹å¥³æ€§ã®ç«‹ã¡çµµã‚’è¿½åŠ  (ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã«dialogã‚’ç§»å‹•)**
        'P4_Flowers': { img: 'https://i.postimg.cc/kD7Qd2TC/image.png', char: 'å¥³æ€§', dialog: 'ã‚ãªãŸã¯ä¸€äººã®å¥³æ€§ã¨å‡ºä¼šã„ã€å½¼å¥³ãŒ**äº”èŒã®é’è“®è¯**ã‚’æŒã£ã¦ã„ã‚‹ã®ã‚’è¦‹ã¤ã‘ãŸã€‚ã“ã‚Œã¯å¤§å¤‰è²´é‡ãªãŠèŠ±ã§ã‚ã‚‹ã€‚å½¼å¥³ã«è“®è¯ã‚’åˆ†ã‘ã¦ã»ã—ã„ã¨é ¼ã‚€ã“ã¨ã«ãªã£ãŸã€‚', text: null, next: 'P5_Choice_A', choices: null, portrait: PORTRAIT_WOMAN_FLOWER },
        
        // èŠ±ã‚’æŒã£ã¦ã„ã‚‹å¥³æ€§ã®ã‚»ãƒªãƒ•ã¨é¸æŠè‚¢
        'P5_Choice_A': { img: 'https://i.postimg.cc/xjztMHHN/IMG-5371.jpg', char: 'å¥³æ€§', dialog: 'ã“ã®äº”èŒã®è“®è¯ã¯ã€æœªæ¥ã®å–„å› ã‚’çµã¶ç¨®ã§ã™ã€‚ã“ã‚Œã‚’ã©ã†ä½¿ã„ã¾ã™ã‹ï¼Ÿ', text: 'å¥³æ€§ã¯ã€è“®è¯ã‚’å·®ã—å‡ºã—ãªãŒã‚‰ã€å–„æ…§ç«¥å­ã®å¿ƒã®ã‚ã‚Šæ–¹ã‚’è©¦ã—ãŸã€‚', next: null, choices: [ { text: 'â‘  5æœ¬ã™ã¹ã¦ã‚’è‡ªåˆ†ã®åŠŸå¾³ã®ãŸã‚ã«ç‡ƒç‡ˆä»ã«ä¾›ãˆã‚‹', next: 'P_Fail_Selfish', correct: false }, { text: 'â‘¡ 5æœ¬ã™ã¹ã¦ã‚’å¥³æ€§ã«ä¾›ãˆã•ã›ã€å½¼å¥³ã®ä¾›é¤Šã‚’å„ªå…ˆã™ã‚‹', next: 'P6_MudPath', correct: true }, { text: 'â‘¢ 2æœ¬ã‚’ä»ã«ã€æ®‹ã‚Šã®3æœ¬ã‚’ç§è‡ªèº«ã®ãŸã‚ã«ä½¿ã†', next: 'P_Fail_Partial', correct: false } ], portrait: PORTRAIT_WOMAN_FLOWER }, 
        
        // ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚·ãƒ¼ãƒ³ã€‚ç«‹ã¡çµµã¯ãªã—
        'P6_MudPath': { img: 'https://i.postimg.cc/pVFqz88p/IMG-5372.jpg', char: null, dialog: null, text: 'å–„æ…§ç«¥å­ã¯åˆ©ä»–ã‚’å„ªå…ˆã—ã€åŠŸå¾³ã‚’è­²ã£ãŸã€‚ã‚„ãŒã¦ç‡ƒç‡ˆä»ãŒ**æ³¥æ¿˜ï¼ˆã¬ã‹ã‚‹ã¿ï¼‰ã®é“**ã‚’é€šã‚‰ã‚Œã‚‹ã“ã¨ã«ãªã£ãŸã€‚ã“ã®ã¾ã¾ã§ã¯ä»ã®ãŠè¶³ãŒæ±šã‚Œã¦ã—ã¾ã†ã€‚', next: 'P7_Choice_B', choices: null, portrait: null },
        
        // å–„æ…§ç«¥å­ã®ã‚»ãƒªãƒ•ã¨é¸æŠè‚¢
        'P7_Choice_B': { img: 'https://i.postimg.cc/pVFqz88p/IMG-5372.jpg', char: 'å–„æ…§ç«¥å­', dialog: 'ä»ã®è¶³å…ƒã‚’æ¸…ã‚ã‚‹ãŸã‚ã€ç§ã¯ã©ã†è¡Œå‹•ã™ã¹ãã§ã—ã‚‡ã†ã‹ï¼Ÿ', text: 'ä»ã¸ã®ä¾›é¤Šã‚’æˆå°±ã•ã›ã‚‹ãŸã‚ã€å–„æ…§ç«¥å­ã¯ç©¶æ¥µã®é¸æŠã‚’è¿«ã‚‰ã‚ŒãŸã€‚', next: null, choices: [ { text: 'â‘  è¿‘ãã®è‰ã‚’é›†ã‚ã€æ³¥ã®ä¸Šã«æ•·ãè©°ã‚ã‚‹', next: 'P_Fail_Temporary', correct: false }, { text: 'â‘¡ è‡ªåˆ†ã®æŒã£ã¦ã„ã‚‹å±¥ç‰©ã‚’è„±ãã€æ³¥ã®ä¸Šã«ç½®ã', next: 'P_Fail_Temporary', correct: false }, { text: 'â‘¢ è‡ªåˆ†ã®é«ªã‚’ã»ã©ãã€æ³¥ã®ä¸Šã«æ•·ãè©°ã‚ã€èº«ã‚’ã‚‚ã£ã¦ä»ã®è¶³ã‚’æ”¯ãˆã‚‹', next: 'P8_Enlightened', correct: true } ], portrait: PORTRAIT_MAN_HANDS },
        
        // ç‡ƒç‡ˆä»ã®ã‚»ãƒªãƒ•
        'P8_Enlightened': { img: 'https://i.postimg.cc/NGHpmTTT/IMG-5373.jpg', char: 'ç‡ƒç‡ˆä»', dialog: 'ã€Œ**æ±ã¯æœªæ¥ä¸–ã«ãŠã„ã¦ã€å¿…ãšé‡ˆè¿¦ç‰Ÿå°¼ä»ã¨ãªã‚‹ã§ã‚ã‚ã†**ã€ï¼ˆè¨˜åˆ¥ï¼‰ã€‚', text: 'ç‡ƒç‡ˆä»ã¯æ³¥ã®ä¸Šã«æ•·ã‹ã‚ŒãŸå–„æ…§ç«¥å­ã®é«ªã‚’è¸ã¿è¶Šãˆã€é™ã‹ã«æœªæ¥ã®æˆä»ã‚’äºˆè¨€ã•ã‚ŒãŸã€‚', next: 'P_Clear', choices: null, portrait: PORTRAIT_BUDDHA }, 
        
        // ã‚¯ãƒªã‚¢ç”»é¢ã€‚ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å½¹ã¨ã—ã¦ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åè¡¨ç¤ºã®ã¿
        'P_Clear': { img: 'https://i.postimg.cc/pXTHz2Cj/IMG-5384.jpg', char: 'èªã‚Šæ‰‹', dialog: 'ğŸŒŸ**å‰ä¸–ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¯ãƒªã‚¢ï¼**ğŸŒŸ ã‚ãªãŸã¯èº«å‘½ã‚’æƒœã—ã¾ã¬ç©¶æ¥µã®å–„è¡Œï¼ˆå› ï¼‰ã‚’ç©ã¿ã¾ã—ãŸï¼ã“ã®åŠŸå¾³ãŒç¾ä¸–ã§ä»é™€ã¨ãªã‚‹ï¼ˆæœï¼‰ã‚’ç´„æŸã—ã¾ã™ï¼', text: null, next: 'P_Menu', choices: null, portrait: null },
        
        // å¤±æ•—ç”»é¢ã€‚ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å½¹ã¨ã—ã¦ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åè¡¨ç¤ºã®ã¿
        'P_Fail_Selfish': { img: FAIL_IMAGE_URL, char: 'èªã‚Šæ‰‹', dialog: 'è‡ªåˆ†ã®åŠŸå¾³ã‚’å„ªå…ˆã™ã‚‹åˆ©å·±çš„ãªå‹•æ©Ÿã§ã¯ã€å¤§ã„ãªã‚‹ä»é™€ã®å› ã‚’ç©ã‚€ã“ã¨ã¯ã§ãã¾ã›ã‚“ã§ã—ãŸ...ã€‚', text: 'é‡ˆè¿¦ã¸ã®é“ã¯é–‰ã–ã•ã‚ŒãŸã€‚', next: 'P_Fail_Menu', choices: null, portrait: null },
        'P_Fail_Partial': { img: FAIL_IMAGE_URL, char: 'èªã‚Šæ‰‹', dialog: 'æƒœã—ã„ï¼åŠŸå¾³ã¯ã‚ã‚Šã¾ã—ãŸãŒã€ä¸€åˆ‡ã‚’æ§ã’ã‚‹è¦šæ‚ŸãŒè¶³ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚é‡ˆè¿¦ã¸ã®é“ã¯é–‰ã–ã•ã‚Œã¾ã—ãŸ...ã€‚', text: 'é‡ˆè¿¦ã¸ã®é“ã¯é–‰ã–ã•ã‚ŒãŸã€‚', next: 'P_Fail_Menu', choices: null, portrait: null },
        'P_Fail_Temporary': { img: FAIL_IMAGE_URL, char: 'èªã‚Šæ‰‹', dialog: 'ã‚ãªãŸã®è¦ªåˆ‡å¿ƒã¯ç´ æ™´ã‚‰ã—ã„ã§ã™ãŒã€ä»é™€ã¨ãªã‚‹ãŸã‚ã«ã¯èº«å‘½ã‚’æƒœã—ã¾ãªã„å®Œå…¨ãªçŒ®èº«ï¼ˆå› ï¼‰ãŒå¿…è¦ã§ã—ãŸã€‚', text: 'é‡ˆè¿¦ã¸ã®é“ã¯é–‰ã–ã•ã‚ŒãŸã€‚', next: 'P_Fail_Menu', choices: null, portrait: null },
        
        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”»é¢ã€‚ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å½¹ã¨ã—ã¦ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åè¡¨ç¤ºã®ã¿
        'P_Menu': { img: 'https://i.postimg.cc/pXTHz2Cj/IMG-5384.jpg', char: 'èªã‚Šæ‰‹', dialog: 'å‰ä¸–ç·¨ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼ã“ã®ã¾ã¾ã€Œç¾ä¸–ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€ã«é€²ã¿ã¾ã™ã‹ï¼Ÿ', text: null, next: null, choices: [ { text: 'ç¾ä¸–ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¸ã¤ã¥ãï¼ˆæœªå®Ÿè£…ï¼‰', next: 'C1_Start', correct: true }, { text: 'æœ€åˆã«ã‚‚ã©ã‚‹', next: 'P1_Intro', correct: true } ], portrait: null },
        'P_Fail_Menu': { img: FAIL_IMAGE_URL, char: 'èªã‚Šæ‰‹', dialog: 'æ®‹å¿µãªãŒã‚‰ã€æ­£ã—ã„å› ã‚’ç©ã‚€ã“ã¨ãŒã§ãã¾ã›ã‚“ã§ã—ãŸã€‚æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã—ã¾ã™ã‹ï¼Ÿ', text: null, next: null, choices: [ { text: 'æœ€åˆã«ã‚‚ã©ã‚‹', next: 'P1_Intro', correct: true } ] , portrait: null },
        
        // ç¾ä¸–ç·¨ï¼ˆæœªå®Ÿè£…ï¼‰ã€‚ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å½¹ã¨ã—ã¦ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åè¡¨ç¤ºã®ã¿
        'C1_Start': { img: 'https://i.postimg.cc/ryrQxWW5/IMG-5375.jpg', char: 'èªã‚Šæ‰‹', dialog: 'ï¼ˆç¾ä¸–ç·¨ï¼‰å‰ä¸–ã®åŠŸå¾³ã«ã‚ˆã‚Šã€ã‚ãªãŸã¯ã¤ã„ã«ç‹æ—ã‚·ãƒƒãƒ€ãƒ¼ãƒ«ã‚¿ã¨ã—ã¦ç”Ÿã¾ã‚Œã¾ã—ãŸã€‚ã“ã“ã‹ã‚‰ã¯ç¾ä¸–ã®ç‰©èªã§ã™ã€‚', text: 'æ–°ãŸãªç”ŸãŒå§‹ã¾ã£ãŸã€‚', next: 'P_Menu', choices: null, portrait: null },
    };

    // --- DOMè¦ç´ ã®å–å¾— ---
    const gameContainer = document.getElementById('gameContainer'); // æ–°ã—ãå–å¾—
    const titleScreen = document.getElementById('titleScreen'); // æ–°ã—ãå–å¾—
    const startButton = document.getElementById('startButton'); // æ–°ã—ãå–å¾—

    const sceneImage = document.getElementById('sceneImage');
    const fadeOverlay = document.getElementById('fadeOverlay');
    const dialogText = document.getElementById('dialogText');
    const smidaName = document.getElementById('smidaName');
    const nextButton = document.getElementById('nextButton');
    const choicesContainer = document.getElementById('choicesContainer');
    const dialogBox = document.getElementById('dialogBox');
    const characterPortrait = document.getElementById('characterPortrait'); // ç«‹ã¡çµµè¦ç´ 

    /**
     * ã‚¯ãƒªãƒƒã‚¯å‹•ä½œã®ãƒ­ã‚°å‡ºåŠ›ï¼ˆéŸ³å£°ã¯è»½é‡åŒ–ã®ãŸã‚ç„¡åŠ¹ï¼‰
     */
    function playClick() {
        console.log("Click (Sound Disabled)");
    }

    /**
     * ã‚¿ã‚¤ãƒ—ãƒ©ã‚¤ã‚¿ãƒ¼ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã§ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹
     */
    function startTyping(fullText) {
        return new Promise((resolve) => {
            clearInterval(typingInterval);
            isTyping = true;
            dialogText.innerHTML = '';
            let charIndex = 0;
            const textChars = fullText.split('');
            nextButton.classList.add('hidden'); 

            typingInterval = setInterval(() => {
                if (charIndex < textChars.length) {
                    // HTMLã‚¿ã‚°ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯
                    if (textChars[charIndex] === '<') {
                        let tagEndIndex = fullText.indexOf('>', charIndex);
                        if (tagEndIndex !== -1) {
                            const tag = fullText.substring(charIndex, tagEndIndex + 1);
                            dialogText.innerHTML += tag;
                            charIndex = tagEndIndex + 1;
                        } else {
                            dialogText.innerHTML += textChars[charIndex];
                            charIndex++;
                        }
                    } else {
                        dialogText.innerHTML += textChars[charIndex]; 
                        charIndex++;
                    }
                } else {
                    clearInterval(typingInterval);
                    isTyping = false;
                    resolve(); 
                    // ã‚¿ã‚¤ãƒ”ãƒ³ã‚°å®Œäº†å¾Œã€å¿…ãšã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã™ã‚‹
                    checkPostTypingAction();
                }
            }, 50);
        });
    }

    /**
     * ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¤ºä¸­ã«ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸã‚‰å³åº§ã«å…¨æ–‡è¡¨ç¤ºã™ã‚‹
     */
    function skipTyping() {
        if (!isTyping) return;
        
        clearInterval(typingInterval);
        isTyping = false;
        playClick(); // ã‚¯ãƒªãƒƒã‚¯ãƒ­ã‚°

        const scene = gameData[currentSceneId];
        // ãƒŠãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‹ã‚»ãƒªãƒ•ã‹ã‚’åˆ¤æ–­ã—ã¦è¡¨ç¤º
        let fullText = scene.char && scene.dialog ? `ã€Œ${scene.dialog}ã€` : scene.text || '';
        if (fullText.length === 0 && scene.text) {
             fullText = scene.text; // charã¨dialogãŒãªã„å ´åˆã¯textã‚’è¡¨ç¤º
        }
        dialogText.innerHTML = fullText;

        checkPostTypingAction();
    }
    
    /**
     * ã‚¿ã‚¤ãƒ—ãŒå®Œäº†ã—ãŸå¾Œã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ (é¸æŠè‚¢è¡¨ç¤º or æ¬¡ã¸ãƒœã‚¿ãƒ³è¡¨ç¤º) ã‚’ãƒã‚§ãƒƒã‚¯
     */
    function checkPostTypingAction() {
        const scene = gameData[currentSceneId];
        
        if (scene.choices && scene.choices.length > 0) {
            // é¸æŠè‚¢ãŒã‚ã‚‹å ´åˆ: é¸æŠè‚¢ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤ºã—ã€ã€Œæ¬¡ã¸ >>ã€ãƒœã‚¿ãƒ³ã¯éè¡¨ç¤º
            choicesContainer.innerHTML = ''; 
            scene.choices.forEach((choice) => {
                const button = document.createElement('button');
                button.className = 'choice-button';
                button.textContent = choice.text;
                button.addEventListener('click', (e) => {
                    e.stopPropagation(); 
                    playClick(); 
                    handleChoice(choice);
                });
                choicesContainer.appendChild(button);
            });
            nextButton.classList.add('hidden');
        } else if (scene.next || currentSceneId.includes('_Fail') || currentSceneId === 'P_Clear' || currentSceneId === 'P_Menu' || currentSceneId === 'P_Fail_Menu') {
            // é¸æŠè‚¢ãŒãªãã€æ¬¡ã«é€²ã‚€ã¹ãå ´æ‰€ãŒã‚ã‚‹å ´åˆ: ã€Œæ¬¡ã¸ >>ã€ãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
            nextButton.classList.remove('hidden');
            choicesContainer.innerHTML = ''; // é¸æŠè‚¢ã‚’ã‚¯ãƒªã‚¢
        }
    }


    /**
     * ç™½ã„ãƒ¢ãƒ¤ã®ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³/ã‚¢ã‚¦ãƒˆã‚’åˆ¶å¾¡ã—ã€æ¬¡ã®ã‚·ãƒ¼ãƒ³ã¸é·ç§»ã™ã‚‹
     * @param {string} sceneId - æ¬¡ã®ã‚·ãƒ¼ãƒ³ID
     */
    function triggerTransition(sceneId) {
        if (isTransitioning) {
            return;
        }
        isTransitioning = true;
        
        // 1. ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³
        fadeOverlay.style.opacity = '1';
        
        // ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ä¸­ã¯ç«‹ã¡çµµã‚’éè¡¨ç¤ºã«ã™ã‚‹
        characterPortrait.classList.remove('active');
        characterPortrait.classList.add('hidden'); 

        setTimeout(() => {
            // 2. ã‚·ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°
            currentSceneId = sceneId;
            renderScene();
            
            // 3. ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¢ã‚¦ãƒˆ
            fadeOverlay.style.opacity = '0';
            
            // 4. ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³çµ‚äº†
            setTimeout(() => {
                isTransitioning = false;
            }, 500); 
        }, 500); 
    }

    /**
     * ç¾åœ¨ã®ã‚·ãƒ¼ãƒ³ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ã„ã¦UIã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹
     */
    async function renderScene() {
        const scene = gameData[currentSceneId];
        if (!scene) {
            console.error('è‡´å‘½çš„ãªã‚¨ãƒ©ãƒ¼: ã‚·ãƒ¼ãƒ³IDãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:', currentSceneId);
            currentSceneId = 'P1_Intro'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚·ãƒ¼ãƒ³ã«æˆ»ã‚‹
            renderScene();
            return;
        }
        
        // P0_Title ã®å ´åˆã¯ã‚²ãƒ¼ãƒ ç”»é¢è¦ç´ ã‚’éè¡¨ç¤º
        if (currentSceneId === 'P0_Title') {
            sceneImage.style.display = 'none';
            dialogBox.style.display = 'none';
            characterPortrait.classList.add('hidden');
            titleScreen.classList.remove('hidden');
            return; // ã“ã“ã§å‡¦ç†ã‚’çµ‚äº†ã—ã€ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã‚’è¡¨ç¤º
        } else {
            titleScreen.classList.add('hidden'); // ã‚²ãƒ¼ãƒ é–‹å§‹å¾Œã€ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã‚’éè¡¨ç¤º
            sceneImage.style.display = 'block';
            dialogBox.style.display = 'flex';
        }

        // èƒŒæ™¯ç”»åƒã®æ›´æ–°
        sceneImage.style.backgroundImage = `url('${scene.img}')`;
        const img = new Image();
        img.onerror = () => {
            sceneImage.style.backgroundImage = `url('https://placehold.co/500x500/94a3b8/ffffff?text=Image+Load+Error')`;
        };
        img.src = scene.img;

        choicesContainer.innerHTML = '';
        nextButton.classList.add('hidden'); 

        let textToDisplay = '';
        
        // ã‚·ãƒ¼ãƒ³ã«dialogãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯charã¨dialogã‚’ä½¿ç”¨ã€ãã†ã§ãªã„å ´åˆã¯textã‚’ä½¿ç”¨
        if (scene.dialog) { 
            smidaName.textContent = scene.char || 'èªã‚Šæ‰‹'; // charãŒãªã„å ´åˆã¯ã€Œèªã‚Šæ‰‹ã€
            smidaName.classList.remove('hidden');
            textToDisplay = `ã€Œ${scene.dialog}ã€`;
        } else {
            smidaName.classList.add('hidden');
            textToDisplay = scene.text || '';
        }

        // **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç«‹ã¡çµµã®è¡¨ç¤º/éè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯**
        // ã‚·ãƒ¼ãƒ³ã«ç«‹ã¡çµµURLãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿è¡¨ç¤º
        if (scene.portrait) { 
            characterPortrait.src = scene.portrait;
            characterPortrait.classList.remove('hidden');
            characterPortrait.classList.add('active'); // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨
        } else {
            characterPortrait.classList.remove('active');
            characterPortrait.classList.add('hidden'); // éè¡¨ç¤º
        }


        await startTyping(textToDisplay);
        
        if (currentSceneId === 'P_Clear') {
            preEonsCleared = true;
        }
    }

    /**
     * é€²è¡Œãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
     */
    function nextScene() {
        if (isTransitioning) {
            return;
        }

        const scene = gameData[currentSceneId];
        if (scene && scene.next) {
            playClick(); 
            triggerTransition(scene.next);
        } else {
             // nextãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ã‚·ãƒ¼ãƒ³ï¼ˆã‚¯ãƒªã‚¢/å¤±æ•—/ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼‰ã‹ã‚‰ã®é·ç§»
             if (currentSceneId.includes('_Fail')) {
                 triggerTransition('P_Fail_Menu');
            } else if (currentSceneId === 'P_Clear') {
                 triggerTransition('P_Menu');
            } else if (currentSceneId === 'P_Menu' || currentSceneId === 'P_Fail_Menu') {
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚„å¤±æ•—ç”»é¢ã§nextãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚‚ä½•ã‚‚èµ·ã“ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ (é¸æŠè‚¢ã§é·ç§»ã•ã›ã‚‹)
                console.log("Menu screen. Please select an option.");
            }
        }
    }
    
    // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š ---

    // **ã€æœ€é‡è¦ã€‘æ¬¡ã®ã‚·ãƒ¼ãƒ³ã¸é€²ã‚€ãŸã‚ã®å°‚ç”¨ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼**
    nextButton.addEventListener('click', (e) => {
        e.stopPropagation(); 
        nextScene();
    });


    // ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãƒœãƒƒã‚¯ã‚¹å…¨ä½“ãŒã‚¿ãƒƒãƒ—ã•ã‚ŒãŸã‚‰ã€**ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹**ã®ã¿
    const dialogBoxElement = document.getElementById('dialogBox');
    dialogBoxElement.addEventListener('click', (event) => {
        // é¸æŠè‚¢ãƒœã‚¿ãƒ³ã‚„Nextãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã¯ç„¡è¦–
        if (event.target.classList.contains('choice-button') || event.target.id === 'nextButton') {
            return;
        }
        
        if (isTyping) {
            // ã‚¿ã‚¤ãƒ—ä¸­: ã‚¹ã‚­ãƒƒãƒ—
            skipTyping();
        } else {
            // ã‚¿ã‚¤ãƒ—å®Œäº†å¾Œ: ä½•ã‚‚ã—ãªã„ã€‚é€²è¡Œã¯ã€Œæ¬¡ã¸ >>ã€ãƒœã‚¿ãƒ³ã«ä»»ã›ã‚‹ã€‚
            return;
        }
    });

    /**
     * é¸æŠè‚¢ãŒé¸ã°ã‚ŒãŸæ™‚ã®å‡¦ç†
     * @param {object} choice - é¸ã°ã‚ŒãŸé¸æŠè‚¢ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
     */
    function handleChoice(choice) {
        if (isTransitioning) return;
        
        playClick(); 
        triggerTransition(choice.next);
    }

    /**
     * ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã‹ã‚‰ã®é·ç§»ï¼‰
     */
    function startGame() {
        playClick(); // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯éŸ³
        triggerTransition('P1_Intro'); // P1_Introã‹ã‚‰ã‚²ãƒ¼ãƒ é–‹å§‹
    }

    // --- åˆæœŸåŒ– ---
    window.onload = () => {
        // ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        startButton.addEventListener('click', startGame);

        // ã¾ãšã¯ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã‚’è¡¨ç¤º
        renderScene(); // P0_Title ãŒåˆæœŸã‚·ãƒ¼ãƒ³ãªã®ã§ã€ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹
        fadeOverlay.style.opacity = '0'; // ãƒ•ã‚§ãƒ¼ãƒ‰ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¯ã‚¿ã‚¤ãƒˆãƒ«ç”»é¢ã§ã¯å¸¸ã«éè¡¨ç¤º
    };

</script>

</body>
</html>
